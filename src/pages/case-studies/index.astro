---
import { getCollection } from 'astro:content'
import SEMLayout from '../../layouts/SEMLayout.astro'
import SEMCaseStudyCard from '../../components/sem/SEMCaseStudyCard.astro'
import SEMCTASection from '../../components/sem/SEMCTASection.astro'

function toSlug(id: string) {
  return id.replace(/\/index\.(mdoc|mdx|md)$/, '').replace(/\.(mdoc|mdx|md)$/, '').replace(/\.md$/, '')
}

function csImage(filename?: string) {
  return filename ? `/images/case-studies/${filename}` : undefined
}

const studies = (await getCollection('case-studies'))
  .filter(s => !s.data.draft)
  .sort((a, b) => a.data.order - b.data.order)
---

<SEMLayout
  title="Case Studies — Brand Success Stories"
  description="Our case studies showcase the impact of our strategic and creative solutions across various industries."
>
  <!-- Hero -->
  <section class="px-6 pt-12 pb-16">
    <div class="mx-auto max-w-7xl">
      <p class="section-label mb-4">
        <svg class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z" />
        </svg>
        OUR WORK
      </p>
      <h1 class="font-accent text-h1 font-medium text-heading md:text-hero">Brand Success Stories That Inspire</h1>
      <p class="mt-6 max-w-2xl text-body-lg leading-relaxed text-text-body">
        Our case studies showcase the impact of our strategic and creative solutions across various industries.
      </p>
    </div>
  </section>

  <!-- Case Studies List -->
  <section class="px-6 pb-20">
    <div class="mx-auto max-w-7xl">
      <div class="flex flex-col gap-10">
        {studies.map(study => (
          <SEMCaseStudyCard
            title={study.data.title}
            client={study.data.client}
            category={study.data.category}
            description={study.data.description}
            href={`/case-studies/${toSlug(study.id)}`}
            image={csImage(study.data.heroImage)}
            logo={csImage(study.data.logo)}
            date={study.data.date}
            duration={study.data.duration}
          />
        ))}
      </div>
    </div>
  </section>

  <!-- CTA -->
  <SEMCTASection
    title="Transformative Projects That Drive Results"
    description="Each case study represents a unique challenge, and successful outcome. Versatile experience across diverse projects, bringing adaptability and valuable skills to any task."
    ctaText="Start a Conversation"
    ctaHref="/contact"
  />

  <!-- Testimonial -->
  <section class="px-6 py-20">
    <div class="mx-auto max-w-3xl text-center">
      <svg class="mx-auto h-10 w-10 text-teal-solid opacity-30" fill="currentColor" viewBox="0 0 24 24">
        <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10H14.017zM0 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151C7.546 6.068 5.983 8.789 5.983 11h4v10H0z" />
      </svg>
      <blockquote class="mt-6 font-accent text-h3 font-medium leading-snug text-heading">
        "Working with Sharp End Marketing has been a game-changer for our brand. They didn't just understand our vision — they elevated it."
      </blockquote>
    </div>
  </section>
</SEMLayout>
